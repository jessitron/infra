# Helm release: otel-demo
# Helm chart: open-telemetry/opentelemetry-demo
components:
  frontend:
    enabled: true
    envOverrides:
      - name: PUBLIC_OTEL_EXPORTER_OTLP_TRACES_ENDPOINT
        value: "/v1/traces"

prometheus:
  server:
    global:
      scrape_interval: 10s
      scrape_timeout: 3s
      evaluation_interval: 30s
    persistentVolume:
      enabled: false
    resources:
      limits:
        memory: 600Mi


opentelemetry-collector:
  extraEnvs:
    - name: HONEYCOMB_API_KEY
      valueFrom:
        secretKeyRef:
          name: honeycomb-api-key
          key: api-key
  image:
    tag: "0.75.0"
  presets:
    kubernetesAttributes:
      enabled: true
    clusterMetrics:
      enabled: true
    kubernetesEvents:
      enabled: true
  config:
    receivers:
      otlp:
        protocols:
          http:
            cors:
              allowed_origins:
                - http://k8s-oteldemo-bbd9607320-1933917927.us-west-2.elb.amazonaws.com
            endpoint: ${MY_POD_IP}:4318
    exporters:
      otlp/honeycomb:
        endpoint: "api.honeycomb.io:443"
        headers:
          "x-honeycomb-dataset": all-the-metrics
          "x-honeycomb-team": ${HONEYCOMB_API_KEY}
      otlp/honeycomb-logs:
        endpoint: "api.honeycomb.io:443"
        headers:
          "x-honeycomb-dataset": all-the-logs
          "x-honeycomb-team":  ${HONEYCOMB_API_KEY}
    service:
      pipelines:
        traces:
          processors: [memory_limiter, batch]
          exporters: [otlp, logging, otlp/honeycomb, spanmetrics]
        metrics:
          exporters: [otlp/honeycomb, prometheus]
        logs:
          exporters: [otlp/honeycomb-logs]
